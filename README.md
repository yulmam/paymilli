![image](https://github.com/user-attachments/assets/3eace139-8c1a-4721-b4c9-22c2a08434f9)


# 💡 Topic

- **온라인 분할 결제 서비스**
- 한 물품을 여러개의 카드로 결제 할 수 있는 페이 서비스
- 삼성청년 소프트웨어 아카데미 11기 프로젝트

# 📝 Summary

온라인에서는 오프라인처럼 **여러 개의 카드로 분할 결제하는 기능이 제공되지 않는 것**를 발견하였습니다.
이에 따라, **카드 한도가 부족하거나 특정 카드의 실적을 채우고 싶은 사용자**를 위해 **온라인에서도 분할 결제가 가능한 시스템을 개발했습니다.** 사용자는 **페이에 여러 개의 카드를 등록·삭제할 수 있으며, 원하는 카드로 결제를 나누어 진행할 수 있습니다.**

# ⭐️ Key Function

- **카드 관리**
    - 카드를 등록 및 삭제 가능, 카드 등록시 카드 서버에서 해당 카드가 존재하는지 검증
    - 대표 카드 등록하여 단일 카드 결제시 사용 가능
- **결제**
    - 일반 결제를 원할 경우, 메인 카드를 사용하여 일반 페이 처럼 결제 진행
    - 분할 결제를 원할 경우, 각 카드 별로 결제 금액을 설정하여 분할 결제 진행
- **결제기록 관리**
    - 결제 기록 리스트 확인
    - 결제 기록을 통해 환불 가능

# 🛠 Tech Stack

FrontEnd : `TypeScript` , `React`

BackEnd : `Java` | `SpringBoot` | `JPA`
DataBase : `MySQL`

Infra : `EC2` | `Nginx` | `AWS S3` | `Docker` | `Jenkins`

# 🧑🏻‍💻 Team

- 프론트 개발자 3명
- 백엔드 개발자 3명

# ⚙️ Architecture

![image](https://github.com/user-attachments/assets/b34146e0-c1ed-4a72-96e1-1142d2812166)


## 🤚🏻 Part

**분할 결제 비즈니스 로직 구현**

> 분할 결제 도중 **하나의 카드라도 결제 실패 시 모든 카드 결제를 실패 처리** 해야 합니다.
> 
- 하나의 카드라도 결제가 실패하면, **카드사에 성공한 결제에 취소 요청을 보냅니다.**
- 기존에는 **동기적으로 순차 결제를 수행했으나**, **`CompletableFuture`와 `@Async`를 활용하여 비동기적으로 동시에 결제를 시도하고, 성공·실패 여부를 포함한 응답 객체를 반환하는 방식으로 리팩토링했습니다.**

**결제 과정 설계 및 구현**

> 카드 결제 과정은 요청 → 인증 및 승인 순으로 이루어지며, **API 호출 순서를 보장**해야 합니다.
> 
- 사용자가 **결제 요청 API 호출시 토큰을 발급**하여, 해당 **토큰을 가진 사용자만 승인 요청 API를 호출**할 수 있도록 설계하였습니다.
- 결제 요청 시 **결제 데이터를 저장하고**, 승인 시 입력된 데이터와 비교하여 결제 정보를 검증하는 로직을 구현하였습니다.

**분할결제 서비스의 결제 요청을 받는 카드사 서버 개발**

> 카드 결제 요청을 받아줄 카드사 서버를 개발 했습니다.
> 
- **`WebClient`**를 활용하여, **페이 서버에서 카드사 서버로 결제 또는 환불 요청**이 들어오면, **은행 API를 호출**하여 결제 또는 환불을 진행하도록 구현하였습니다.

## 🤔 Learned

- 다중 서버 환경에서 **데이터의 일관성에 대해 생각**하는 기회가 됐습니다.
- **예외 처리를 하나의 클래스**로 관리 했으며**, 에러 코드는 ENUM 으로 관리** 했습니다. 이를 통해 코드 중복을 줄였습니다.
- Key를 기반하여 **api 요청 순서를 보장** 할 수 있음을 알게 됐습니다.
- 리팩토링 과정에서 **Spring의 비동기 처리 방식**을 공부하게 되었으며, **`@Async`와 `CompletableFuture`의 활용법**을 익혔습니다.
